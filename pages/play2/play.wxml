<!--pages/play2/play.wxml-->
<view id="play-page">
    <!--地图-->
    <scroll-view id="play-map" scroll-x="{{true}}" scroll-y="{{true}}" scroll-with-animation='{{true}}' bind:tap="touchMap">
        <!--背景地图-->
        <image src='{{mapBg}}' style='position:absolute;top:0;left:0; height:{{ mapHeight * scale }}rpx; width:{{ mapWidth * scale }}rpx'></image>
        <!--路径-->
        <view class="play-line {{item.tracked ? 'solid-line': 'dashed-line'}}" wx:for="{{ lines }}" wx:key="{{index}}"
              style="position:absolute;left:{{item.x * scale}}rpx;top:{{item.y * scale}}rpx;width:{{item.wd * scale}}rpx;transform-origin: 0 0; transform:translateY(-4rpx) rotate({{item.rotation}}deg)"
        ></view>
        <!--起点-->
        <view class="play-start" style="position:absolute;left:{{startPoint.x * scale}}rpx;top:{{startPoint.y * scale}}rpx; transform: translate(-50%, -96%)">
            <image class="play-start-img" src="{{startPoint.img}}" ></image>
        </view>
        <!--景点-->
        <view class="play-spots" wx:for="{{ spots }}" wx:key="{{index}}" data-sid="{{item.id}}" catch:tap="tapSpot" style="position:absolute;left:{{item.x * scale}}rpx;top:{{item.y * scale}}rpx;">
            <image class="play-spot-img" src="{{item.tracked ? item.img2 : item.img1}}" style="width:{{item.wd * scale}}rpx;height:{{item.ht * scale}}rpx"></image>
            <text class="play-spot-txt">{{item.name}}</text>
        </view>
        <!--小人.自己-->
        <view wx:if="{{roleMe}}" class="play-role {{roleMe.walk ? 'walk' : 'stand' }}" style="background-image: url({{roleMe.img}});position:absolute;left:{{roleMe.x * scale}}rpx;top:{{roleMe.y * scale}}rpx;transform:scaleX({{roleMe.scale}})">
            <image class="role-event-img" wx:if="{{unreadEventCnt > 0}}" src="{{eventTipImg}}"></image>
        </view>
        <!--小人.组队好友-->
        <view wx:if="{{roleFriend}}" class="play-role {{roleFriend.walk ? 'walk' : 'stand' }}" style="background-image: url({{roleFriend.img}});position:absolute;left:{{roleFriend.x * scale}}rpx;top:{{roleFriend.y * scale}}rpx;transform:rotate({{roleFriend.rotation}}deg)">
            <image class="role-event-img" wx:if="{{unreadEventCnt > 0}}" src="{{eventTipImg}}"></image>
        </view>
    </scroll-view>
    <!--控件-固定-->
    <view id="play-control-normal" class="controll-layer">
        <!-- 缩放按钮  -->
        <view class="zoomBtn f-r-sa">
            <view class="add" catch:tap="zoomplus"></view>
            <view class="minus" catch:tap="zoomminus"></view>
        </view>
    </view>
    <!--控件-非规划路线状态-->
    <view id="play-control-playing" wx:if="{{!planing}}" class="controll-layer">
        <image wx:if="{{weather.length>0}}" class="weather" src="https://gengxin.odao.com/update/h5/travel/weather/{{weather}}.png"></image>
        <!-- 提示 -->
        <view class="tip" bindtap='popPlayIntro'></view>
        <!-- 屏幕边缘按钮 -->
        <view class="mission f-c-fs" bindtap='popMissionInfo'>
            <text class="fontWhite missionText font font26">任务</text>
            <view class="progressBox">
                <view class="progressBar" style="width:{{taskPer}}rpx;"></view>
            </view>
        </view>
        <view class="changeLine f-c-fs" bindtap='chgLine' wx:if="{{started}}">
            <text class="fontWhite changeLineText font font26">修改路线</text>
            <text class="fontWhite changeLineMoney font font26">$100</text>
        </view>
        <!-- 按钮组 -->
        <view class="btnBoxWrap f-c-fs">

            <!-- 三个按钮 -->
            <view class="btnBox f-r-sa">
                <view class="travelTips font fontWhite font28" catch:tap="toPr">旅行攻略</view>
                <view class="travelStart font fontWhite  font32" wx:if="{{!started}}" catch:tap="chgLine">规划路线</view>
                <view class="travelStart font fontWhite  font32" wx:else>正在游玩</view>
                <view class="tarvelProps font fontWhite font28" catch:tap="toProps">旅行道具</view>
            </view>
            <!-- 虚拟地图警告 -->
            <view class="warningBox"></view>
        </view>
    </view>
    <!--控件-规划路线-->
    <view id="play-control-editing" wx:else  class="controll-layer">
        <view class="travelStart font fontWhite font32" catch:tap="sendPath">开始游玩</view>
    </view>

    <!--<directions helpId="2" resHeight="980" wx:if="{{showIntro}}" title="玩法介绍" bind:confirm='hidePlayIntro'></directions>-->

    <!--弹出层-->
    <view id="play-pops" wx:if="{{showPop}}">
        <view id="play-pop-bg" bind:tap="hidePop"></view>
        <!--玩法介绍-->
        <pop-play-intro wx:if="{{showPlayIntro}}" bind:hide="hidePop"></pop-play-intro>
        <!--普通事件-->
        <pop-event-normal wx:if="{{showEventNormal}}" bind:hide="hidePop"></pop-event-normal>
        <!--答题事件-->
        <pop-event-quest wx:if="{{showEventQuest}}" bind:hide="hidePop"></pop-event-quest>
        <!--首次免费租赁-->
        <pop-free-rent wx:if="{{showFreeRent}}" bind:hide="hidePop"></pop-free-rent>
        <!--获得明信片-->
        <pop-got-post wx:if="{{showGotPost}}" bind:hide="hidePop"></pop-got-post>
        <!--任务信息-->
        <pop-mission-info wx:if="{{showMissionInfo}}" bind:hide="hidePop"></pop-mission-info>
    </view>
</view>
<guide wx:if="{{!hasPlay}}" bindplayed='finishGuide'></guide>

