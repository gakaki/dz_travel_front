<!--pages/play2/play.wxml-->
<view id="play-page">
    <!--地图-->
    <scroll-view id="play-map" scroll-x="{{true}}" scroll-y="{{true}}" scroll-with-animation='{{true}}' bind:tap="touchMap">
        <!--背景地图-->
        <image src='{{mapBg}}' style='position:absolute;top:0;left:0; height:{{ mapHeight * scale }}rpx; width:{{ mapWidth * scale }}rpx'></image>
        <!--路径-->
        <view class="play-line {{item.tracked ? 'solid-line': 'dashed-line'}}" wx:for="{{ lines }}" wx:key="{{index}}"
              style="position:absolute;left:{{item.x * scale}}rpx;top:{{item.y * scale}}rpx;width:{{item.wd * scale}}rpx;transform-origin: 0 0; transform:translateY(-4rpx) rotate({{item.rotation}}deg)"
        ></view>
        <!--起点-->
        <view class="play-start" style="position:absolute;left:{{startPoint.x * scale}}rpx;top:{{startPoint.y * scale}}rpx; transform: translate(-50%, -96%)">
            <image class="play-start-img" src="{{startPoint.img}}" style="width:{{80 * scale}}rpx;height:{{93 * scale}}rpx;" ></image>
        </view>
        <!--景点-->
        <view class="play-spots" wx:for="{{ spots }}" wx:key="{{index}}" data-sid="{{item.id}}" catch:tap="tapSpot" style="position:absolute;left:{{item.x * scale}}rpx;top:{{item.y * scale}}rpx;">
            <image class="play-spot-img" src="{{item.tracked ? item.img2 : item.img1}}" style="width:{{item.wd * scale}}rpx;height:{{item.ht * scale}}rpx"></image>
            <text class="play-spot-txt">{{item.name}}</text>
            <text class="play-spot-tm" wx:if="{{item.arriveTime}}">{{item.arriveTime}}</text>
        </view>
        <!--小人.自己-->
        <view wx:if="{{roleMe}}" class="{{roleMe.roleCls}} {{roleMe.walkCls}}" bind:tap="tapRole"
              style="background-image: url({{roleMe.img}});background-size:auto 100%;position:absolute;left:{{roleMe.x * scale}}rpx;top:{{roleMe.y * scale}}rpx;width:{{roleMe.wd * scale}}rpx;height:{{roleMe.ht * scale}}rpx;transform:scaleX({{roleMe.scale}}) translate(-50%, -90%);">
            <image class="role-event-img" wx:if="{{unreadEventCnt > 0}}" src="{{eventTipImg}}" style="position: absolute; left: -20rpx;top: -50rpx;width:{{30 * scale}}rpx;height: {{30 * scale}}rpx;"></image>
        </view>
        <!--小人.组队好友-->
        <view wx:if="{{roleFriend}}" class="{{roleFriend.roleCls}} {{roleFriend.walkCls}}" bind:tap="tapRole"
              style="background-image: url({{roleFriend.img}});background-size:auto 100%;position:absolute;left:{{roleFriend.x * scale}}rpx;top:{{roleFriend.y * scale}}rpx;width:{{roleFriend.wd * scale}}rpx;height:{{roleFriend.ht * scale}}rpx;transform:rotate({{roleFriend.rotation}}deg) translate(-50%, -90%);">
            <image class="role-event-img" wx:if="{{unreadEventCnt > 0}}" src="{{eventTipImg}}" style="position: absolute; left: -20rpx;top: -30rpx;width:{{30 * scale}}rpx;height: {{30 * scale}}rpx;"></image>
        </view>
    </scroll-view>
    <!--控件-固定-->
    <view id="play-control-normal" class="controll-layer">
        <!-- 缩放按钮  -->
        <view class="zoomBtn f-r-sa">
            <view class="add" catch:tap="zoomplus"></view>
            <view class="minus" catch:tap="zoomminus"></view>
        </view>
    </view>
    <!--控件-非规划路线状态-->
    <view id="play-control-playing" wx:if="{{!planing}}" class="controll-layer">
        <image wx:if="{{weather.length>0}}" class="weather" src="https://gengxin.odao.com/update/h5/travel/weather/{{weather}}.png"></image>
        <!-- 提示 -->
        <view class="tip" bindtap='popPlayIntro'></view>
        <!-- 屏幕边缘按钮 -->
        <view class="mission f-c-fs" bindtap='popMissionInfo'>
            <text class="fontWhite missionText font font26">任务</text>
            <view class="progressBox">
                <view class="progressBar" style="width:{{taskPer}}%;"></view>
            </view>
        </view>
        <view class="changeLine f-c-fs" bindtap='chgLine' wx:if="{{started}}">
            <text class="fontWhite changeLineText font font26" >修改路线</text>
            <text class="fontWhite changeLineMoney font font26" wx:if="{{started}}">$100</text>
        </view>
        <!-- 按钮组 -->
        <view class="btnBoxWrap f-c-fs">

            <!-- 三个按钮 -->
            <view class="btnBox f-r-sa">
                <view class="travelTips font fontWhite font28" catch:tap="toPr">旅行攻略</view>
                <view class="travelStart font fontWhite  font32" wx:if="{{!started}}" bindtap="chgLine">规划路线</view>
                <view class="travelStart start-icon font fontWhite  font32" wx:else>游玩中</view>
                <view class="travelStart start-icon font fontWhite  font32" wx:if="{{spotsAllTraced}}">游玩结束</view>
                <view class="tarvelProps font fontWhite font28" catch:tap="toProps">旅行道具</view>
            </view>
            <!-- 虚拟地图警告 -->
            <view class="warningBox"></view>
        </view>
    </view>
    <!--控件-规划路线-->
    <view id="play-control-editing" wx:else  class="controll-layer">
        <view class="travelStart font fontWhite font32" catch:tap="sendPath">开始游玩</view>
    </view>

    <!--玩法介绍-->
    <directions helpId="2" resHeight="980" wx:if="{{showPlayIntro}}" title="玩法介绍" bind:confirm='hidePop'></directions>

    <!--弹出层-->
    <view id="play-pops" wx:if="{{showPop}}">
        <view id="play-pop-bg" bind:tap="hidePop"></view>

        <!--普通事件-->
        <pop-event-normal wx:if="{{showEventNormal}}" class="play-pop" bind:hide="hidePop" cityName="{{cityName}}" quest="{{quest}}" current="{{curEvtIdx}}" total="{{totalEvt}}" bind:next="toNextEvent"></pop-event-normal>
        <!--答题事件-->
        <pop-event-quest wx:if="{{showEventQuest}}" class="play-pop" bind:hide="hidePop" cityName="{{cityName}}" quest="{{quest}}" current="{{curEvtIdx}}" total="{{totalEvt}}" bind:next="toNextEvent"></pop-event-quest>
        <!--首次免费租赁-->
        <pop-free-rent wx:if="{{showFreeRent}}" class="play-pop" bind:hide="hidePop"></pop-free-rent>
        <!--获得明信片-->
        <pop-got-post wx:if="{{showGotPost}}" class="play-pop" bind:hide="hidePop" picture="{{postPicture}}" spotName="{{postSpotName}}"></pop-got-post>
        <!--任务信息-->
        <pop-mission-info wx:if="{{showMissionInfo}}" class="play-pop" bind:hide="hidePop" single="{{!partener}}" task="{{task}}"></pop-mission-info>
    </view>
</view>
<guide wx:if="{{!hasPlay}}" bindplayed='finishGuide'></guide>

